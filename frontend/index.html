<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Waste2Art Generator</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 40px;
  background: #f4f4f4;
}
.container {
  width: 420px;
  margin: auto;
  padding: 20px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 0 10px #ccc;
}
#preview, #outputImage {
  width: 100%;
  margin-top: 12px;
  border-radius: 6px;
  display: none;
}
select, textarea {
  width: 100%;
  margin-top: 10px;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
textarea { resize: none; }
.fade-slide {
  animation: fadeSlide 0.6s ease;
}

@keyframes fadeSlide {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

button {
  width: 100%;
  padding: 12px;
  background: #0a84ff;
  color: white;
  border: none;
  font-size: 16px;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 15px;
}

.secondary-btn {
  background: #e8f1ff;
  color: #0a84ff;
  border: 1px solid #0a84ff;
  margin-top: 10px;
}

#status {
  margin-top: 15px;
  font-weight: bold;
  min-height: 24px;
}

.section {
  margin-top: 25px;
  padding-top: 15px;
  border-top: 1px solid #eee;
}

.section h3 {
  margin-bottom: 10px;
}

.collapsible {
  cursor: pointer;
  font-weight: 600;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#reasoningContent {
  display: none;
  margin-top: 10px;
}

#infoContent {
  font-size: 16px;
  line-height: 1.6;
}

.factTag {
  display: inline-block;
  margin-top: 10px;
  padding: 4px 10px;
  font-size: 12px;
  background: rgba(255,255,255,0.6);
  border-radius: 12px;
  font-weight: 600;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>

<div class="container">
<h2>Waste2Art AI Generator</h2>

<input type="file" id="inputImage" accept="image/*">
<img id="preview">

<select id="style">
  <option value="">ðŸŽ¨ Art Style (optional)</option>
  <option value="minimal">Minimalist</option>
  <option value="abstract">Abstract</option>
  <option value="modern">Modern</option>
  <option value="handcrafted">Handcrafted</option>
</select>

<select id="mood">
  <option value="">ðŸŒ¿ Mood (optional)</option>
  <option value="calm">Calm</option>
  <option value="hopeful">Hopeful</option>
  <option value="earthy">Earthy</option>
  <option value="dramatic">Dramatic</option>
</select>

<select id="art_target">
  <option value="">ðŸŽ¨ AI Suggested (Auto)</option>
  <option value="lamp sculpture">Lamp</option>
  <option value="flower sculpture">Flower</option>
  <option value="decor artwork">Decor</option>
  <option value="recycled sculpture">Sculpture</option>
  <option value="installation artwork">Installation</option>
</select>

<textarea id="notes" rows="3"
placeholder="Optional creative notes (style only, max 150 chars)"></textarea>

<button onclick="generateArt()">Generate Artwork</button>
<p id="status"></p>

<!-- INFO BOX -->
<!-- INFO BOX (REFINED â€“ NO PROGRESS BAR) -->
<div id="infoBox" style="
display:none;
background: linear-gradient(135deg, #eef4ff, #f5fff9);
border-radius:14px;
padding:22px 24px;
margin-top:25px;
color:#1f2937;
box-shadow:0 6px 20px rgba(0,0,0,0.08);
opacity:0;
transform:translateY(14px);
transition:opacity 0.5s ease, transform 0.5s ease;
text-align:left;
">

  <div id="infoTitle" style="
    font-size:14px;
    font-weight:600;
    letter-spacing:0.4px;
    color:#2563eb;
    margin-bottom:12px;
    text-transform:uppercase;">
    Sustainability Insight
  </div>

  <div id="infoContent" style="
    font-size:15px;
    line-height:1.65;
    color:#374151;
    max-width:360px;">
  </div>

</div>


<!-- RESULT SECTION -->
<div class="section" id="resultSection" style="display:none;">
  <h3>ðŸŽ¨ Your Recycled Artwork</h3>
  <p style="font-size:14px;color:#555;">
    This artwork was generated by transforming detected waste materials into a
    creative, sustainable art concept.
  </p>

  <img id="outputImage">

  
</div>

<!-- REASONING (COLLAPSIBLE â€“ IMPROVED) -->
<div class="section" id="reasoningBox" style="display:none;">
  <div class="collapsible" onclick="toggleReasoning()">
    ðŸ§  How the artwork was created
    <span id="toggleIcon">âž•</span>
  </div>

  <div id="reasoningContent" style="
    margin-top:12px;
    font-size:14px;
    line-height:1.6;
    color:#374151;">
  </div>
</div>


</div>

<script>
const statusEl = document.getElementById("status");
const btn = document.querySelector("button");
let generatedImageURL = "";

const messages = [
 "ðŸ” Analyzing image for objects...",
 "ðŸ§ª Identifying materials and biodegradability...",
 "ðŸ§  Composing creative prompt...",
 "ðŸŽ¨ Generating artwork using Stable Diffusion...",
 "â³ Finalizing image..."
];

let rotInterval = null;

function startStatusCycle() {
 let i = 0;
 statusEl.innerText = messages[0];
 rotInterval = setInterval(() => {
   i++;
   if (i < messages.length) {
     statusEl.innerText = messages[i];
     if (messages[i].includes("Finalizing")) startInfoBox();
   }
 }, 2000);
}

function stopStatus(msg) {
 clearInterval(rotInterval);
 statusEl.innerText = msg;
}

function toggleReasoning() {
 const content = document.getElementById("reasoningContent");
 const icon = document.getElementById("toggleIcon");
 const open = content.style.display === "block";
 content.style.display = open ? "none" : "block";
 icon.innerText = open ? "âž•" : "âž–";
}

function showReasoning(reasoning) {
  const box = document.getElementById("reasoningBox");
  const content = document.getElementById("reasoningContent");

  const materials = Object.entries(reasoning.materials || {})
    .map(([k,v]) => `${v} ${k}${v > 1 ? "s" : ""}`)
    .join(", ");

  content.innerHTML = `
    <p><b>1. Object Detection</b><br>
    The system analyzed the uploaded image and identified multiple waste objects.
    After removing uncertain or irrelevant detections, 
    <b>${reasoning.accepted_detections}</b> object(s) were confidently selected
    (${materials}).</p>

    <p><b>2. Material Classification</b><br>
    Each selected object was evaluated based on material characteristics.
    The detected waste was classified as 
    <b>${reasoning.non_biodegradable > 0 ? "non-biodegradable" : "biodegradable"}</b>,
    indicating suitability for recycling-based reuse.</p>

    <p><b>3. Creative Interpretation</b><br>
    Using the identified materials and their quantity, a creative concept was formed
    to demonstrate how everyday waste can be transformed into functional or artistic objects,
    such as decor items or utility pieces.</p>

    <p><b>Conclusion</b><br>
    The generated artwork visually represents sustainable reuse of discarded materials,
    highlighting how waste can be reimagined as valuable and meaningful design.</p>
  `;

  box.style.display = "block";
}


function downloadImage() {
 const a = document.createElement("a");
 a.href = generatedImageURL;
 a.download = "waste2art_artwork.png";
 document.body.appendChild(a);
 a.click();
 document.body.removeChild(a);
}

function generateArt() {
 const fileInput = document.getElementById("inputImage");
 if (!fileInput.files.length) return alert("Upload an image first");

 btn.disabled = true;
 startStatusCycle();

 const formData = new FormData();
 formData.append("image", fileInput.files[0]);
 formData.append("style", style.value);
 formData.append("mood", mood.value);
 formData.append("notes", notes.value);
 formData.append("art_target", document.getElementById("art_target").value);

 fetch("http://127.0.0.1:5000/process", { method:"POST", body:formData })
 .then(res => res.json())
 .then(data => {
   stopInfoBox();
   btn.disabled = false;

   if (data.error) {
     stopStatus("âš  " + data.error);
     return;
   }

   const filename = data.image_path.split("\\").pop();
   generatedImageURL = `http://127.0.0.1:5000/image/${filename}`;

   outputImage.src = generatedImageURL;
   outputImage.style.display = "block";
   document.getElementById("resultSection").style.display="block";

   stopStatus("âœ… Artwork generated successfully");


   if (data.generation_status === "sd_not_available") {
   stopStatus("âš  Stable Diffusion not running. Prompt generated successfully.");
   console.log("PROMPT:", data.prompt);
   return;
}
if (!data.image_path) {
   stopStatus("âš  Prompt generated. Awaiting Stable Diffusion execution.");
   console.log("PROMPT:", data.prompt);
   return;
}

   if (data.reasoning) showReasoning(data.reasoning);
 })
 .catch(err => {
   console.error(err);
   stopStatus("âŒ Generation failed");
 })
 .finally(()=> btn.disabled=false);
}

inputImage.addEventListener("change", e => {
 preview.src = URL.createObjectURL(e.target.files[0]);
 preview.style.display="block";
});

/* FUN FACTS */
const factIcons=["ðŸŒ","ðŸƒ","â™»ï¸","ðŸŽ¨","ðŸŒˆ","ðŸ¢","ðŸŒ¿","ðŸ”¥","ðŸ§´","ðŸ—‘ï¸","ðŸ’¡","ðŸŒŠ","ðŸªµ","ðŸ­"];
const funFacts = [
  "Recycling one plastic bottle saves enough energy to power a light bulb for six hours.",
  "Recycling a ton of paper can prevent the cutting of approximately 17 trees.",
  "Aluminum can be recycled indefinitely without losing material quality.",
  "Globally, less than 10% of all plastic waste has been recycled.",
  "Many contemporary artists use discarded materials to create functional art.",
  "Plastic pollution causes harm to over a million marine animals each year.",
  "Most plastics remain in the environment for decades or longer.",
  "Manufacturing new plastic consumes a significant portion of global oil supply.",
  "A single plastic bottle can take up to 450 years to decompose naturally.",
  "An average individual generates more than 1.5 kilograms of waste per day.",
  "Upcycling converts waste materials into products of higher value.",
  "Millions of tons of plastic enter the oceans every year.",
  "Recycling cardboard significantly reduces oil and water consumption.",
  "Producing new plastic emits far more COâ‚‚ than recycling existing materials."
];


let factIndex=0, infoInterval=null;
function startInfoBox(){
  infoBox.style.display = "block";
  setTimeout(() => {
    infoBox.style.opacity = "1";
    infoBox.style.transform = "translateY(0)";
  }, 30);

  renderFact();
  infoInterval = setInterval(renderFact, 6500);
}

function stopInfoBox(){
 clearInterval(infoInterval);
 infoBox.style.opacity=0;
 setTimeout(()=>infoBox.style.display="none",600);
}
function renderFact() {
  // Reset animation
  infoContent.classList.remove("fade-slide");
  void infoContent.offsetHeight;

  infoContent.innerHTML = funFacts[factIndex];
  infoContent.classList.add("fade-slide");

  factIndex = (factIndex + 1) % funFacts.length;
}


</script>

</body>
</html>
